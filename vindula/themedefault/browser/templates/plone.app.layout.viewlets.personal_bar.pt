<div id="portal-personaltools-wrapper"
     i18n:domain="plone"
     tal:define="checkPermission nocall: context/portal_membership/checkPermission;
                 member context/@@plone_portal_state/member;

                 view_user python:context.restrictedTraverse('@@vindula-linkuser');
                 view_myvindula python:context.restrictedTraverse('@@myvindula');

                 prefs_user python: view_myvindula.get_prefs_user(member.getUserName());
                 recados  python: view_myvindula.get_recados(member.getUserName());
                 notificacoes python: view_myvindula.get_notificacoes(member.getUserName());

                 links view_user/update|nothing">

  <h5 class="hiddenStructure" i18n:translate="heading_personal_tools">Personal tools</h5>

  <ul class="actionMenu deactivated" id="portal-personaltools"
      tal:condition="not: view/anonymous">
      <li>
        <!-- Dados para utilizacao da macro -->
        <div class="my-profile left">
            <tal:def define="size_img string:30px;
                             user_profiles member/getUserName|nothing;
                             item prefs_user;">
                <metal:use use-macro="context/myvindula-imageprofiles-macro/macros/userimage"/>
            </tal:def>
        </div>
        <a tal:attributes="href string:${context/portal_url}/myvindulalistuser;"
           tal:content="python: view_myvindula.name_user_top(prefs_user.get('name'))"
           class="left"
           id="personaltools-myvindula"
           href="">Meu Perfil</a>
      </li>

      <tal:rep define="unidadeprincipal python:view_myvindula.getUnidadePrincipalSigla(member.getUserName(),1);"
               condition="unidadeprincipal">
        <li>
          <a href="" tal:content="unidadeprincipal">Unidade</a>
        </li>
      </tal:rep>


      <li class="show-box-hidden has-count has-new vd-message">
        <a tal:attributes="href string:${context/portal_url}/@@myvindulalistrecados;" id="personaltools-recados">
           <i class="vindula-icon-envelop"></i>
           <span class="jewel-count" id="numero_recados">
               <span tal:content="python:recados.count()"></span>
           </span>
        </a>
        <div class="box-updates box-message box-hidden">
            <div class="seta-box">
                <img tal:attributes="src string:${context/portal_url}/++resource++vindula.tile/images/seta-box.png" />
            </div>
            <div class="updates-header clear">
              <div class="left"><strong>Entrada</strong></div>
              <div class="right"><a href="#">Nova Mensagem</a></div>
            </div>
            <div class="scrollable-area updates-content" id="list-notify">
              <ul class="letters no-bullet">
                  <tal:recados repeat="recado python:recados[:5]">
                      <li tal:attributes="class python:recado.viewed and 'container-item' or 'container-item unread'">
                        <a href="#">
                            <div class="clear">
                                <div class="circle-mark">
                                </div>
                                <img class="left" width="50" height="50" 
                                     tal:attributes="src string:${here/portal_url}vindula-api/myvindula/user-picture/photograph/${recado/username}/True">
                                <div class="left info-updates">
                                    <div>
                                        <strong tal:content="recado/username"></strong>
                                    </div>
                                    <div>
                                        <span tal:content="recado/date_created"></span>
                                    </div>
                                </div>
                            </div>
                        </a>
                      </li>
                  </tal:recados>
              </ul>
            </div>
            <div class="updates-footer clear">
              <strong><a href="#">Ver todas</a></strong>
            </div>
        </div>
      </li>
      
      <li class="show-box-hidden has-count has-new vd-notify">
        <a tal:attributes="href string:${context/portal_url}/" id="personaltools-recados">
           <i class="vindula-icon-earth"></i>
           <span class="jewel-count" id="numero_recados">
               <span tal:content="python:notificacoes.count()"></span>
           </span>
        </a>
        
        <div class="box-updates box-notify box-hidden">
            <div class="seta-box">
                <img tal:attributes="src string:${context/portal_url}/++resource++vindula.tile/images/seta-box.png" />
            </div>
            <div class="updates-header clear">
              <div class="left"><strong>Notificações</strong></div>
              <div class="right"><a href="#">Configurações</a></div>
            </div>
            <div class="scrollable-area updates-content" id="list-notify">
              <ul class="letters no-bullet">
                  <tal:notificacoes repeat="notificacao python:notificacoes[:5]">
                      <li tal:attributes="class python:notificacao.viewed and 'container-item' or 'container-item unread'">
                        <a href="#">
                            <div class="clear">
                                <div class="circle-mark">
                                </div>
                                <img class="left" width="50" height="50" 
                                     tal:attributes="src string:${here/portal_url}vindula-api/myvindula/user-picture/photograph/${notificacao/username}/True">
                                <div class="left info-updates">
                                    <div>
                                        <strong tal:content="notificacao/actor"></strong><span tal:content="notificacao/action"></span>
                                    </div>
                                    <div>
                                        <span tal:content="notificacao/date_created"></span>
                                    </div>
                                </div>
                            </div>
                        </a>
                      </li>
                  </tal:notificacoes>
              </ul>
            </div>
            <div class="updates-footer clear">
              <strong><a href="#">Ver todas</a></strong>
            </div>
        </div>
      </li>
      
      <li>
        <a tal:attributes="href string:${context/portal_url}/logout;">
            <i class="vindula-icon-switch"></i>
            <span>Sair</span>
        </a>
      </li>
      <li class="show-box-hidden">
          <a href="#">
            <i class="vindula-icon-cog"></i>
          </a>
          
          <div class="box-settings box-hidden">
            <div class="seta-box">
                <img tal:attributes="src string:${context/portal_url}/++resource++vindula.tile/images/seta-box.png" />
            </div>
            <ul>
                <tal:rep repeat="link links">
                    <li>
                        <a tal:attributes="href link/url|nothing;
                        id string:personaltools-${link/id};"
                        tal:content="link/title|nothing"></a>
                    </li>
                </tal:rep>
                <li tal:condition="python:checkPermission('Plone Site Setup: Overview', context)">
                    <a tal:attributes="href string:${context/portal_url}/@@overview-controlpanel;"
                    href="">Painel de Controle</a>
                </li>
            </ul>
          </div>
      </li>
  </ul>

  <ul class="actionMenu deactivated" id="portal-personaltools"
      tal:condition="view/anonymous">
    <!-- Barra Usuario Anonimo -->
    <li id="anon-personalbar">
      <tal:actions repeat="action view/user_actions">
        <a href=""
           tal:attributes="href action/url;
                           id string:personaltools-${action/id};
                           target action/link_target|nothing;"
            tal:content="action/title"
            i18n:translate="">
              action title
        </a>
      </tal:actions>
    </li>
  </ul>




</div>