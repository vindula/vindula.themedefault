<html>
	<head>
		<script type="text/javascript" 
    				tal:attributes="src string:${context/portal_url}/jquery.js"></script>
    				
		<script type="text/javascript" 
    				tal:attributes="src string:${view/static}/cropper/js/jquery.Jcrop.js"></script>
    				
		<link type="text/css" charset="utf-8" rel="stylesheet" 
					  tal:attributes="href string:${view/static}/cropper/css/jquery.Jcrop.css"/>
				
		<link rel="stylesheet" href="/public.css" />
		<link rel="stylesheet" href="/columns.css" />
		<link rel="stylesheet" href="/++resource++vindula.themedefault/css/vindula_theme.css" />
		<link rel="stylesheet" href="/++resource++vindula.themedefault/css/geral.css" />	
 		<link rel="stylesheet" href="/++resource++vindula.themedefault/css/cont_pagina.css" />
 		<link rel="stylesheet" href="/++resource++vindula.themedefault/css/topo_nav.css" />
 		<link rel="stylesheet" href="/++resource++vindula.themedefault/css/titulos.css" />
 		<link rel="stylesheet" href="/++resource++vindula.controlpanel/alert_style.css" />
	</head>
    <body style="background:none; ">
    	
		<div tal:define="member context/@@plone_portal_state/member;
						 error view/error|nothing;" id="content">         
				<h1>Alterar sua imagem do perfil</h1>
				<div id="upload-image" tal:condition="python: not request.get('form.submitted',None) and
															  not request.get('form.crop',None) or error">
				<div id="alert-display">
					<dl class="portal-Message warning" tal:condition="error">
						<dt id="title-alert">Informação</dt>
						<dd id="text-alert" tal:content="view/error|nothing">error</dd>
		    		</dl>	
				</div>														  
					<fieldset id="fieldset-global-settings">
				    	<legend id="fieldsetlegend-global-settings">Faça o upload da sua foto</legend>
						<form method="post" enctype="multipart/form-data" name="upload-imge" id="myform"
							 tal:attributes="action string:${context/absolute_url|nothing}/myvindula-user-crop">
							
							<input type="hidden" id="username" name="username" value="" 
								    tal:attributes="value member/getUserName|nothing">
							<input name="photo" id="photo" type="file" value="" accept="image/*"/>
							
							<div id="buttom">
								<input type="hidden" name="form.submitted:boolean" value="True" />
								<input type="submit" name="submit" value="Enviar" class="context bt_comments" />
							</div>
						</form>
					</fieldset>
				</div>
				<div id="crop-image" tal:define="req request/form.submitted|nothing" 
									 tal:condition="python: req and not error">
					<script type="text/javascript" charset="utf-8" tal:attributes="src string:${view/static}/js/crop_image_user.js" />
					<fieldset id="fieldset-global-settings">
				    	<legend id="fieldsetlegend-global-settings">Marque a área da foto a ser salva</legend>
						<form method="post" enctype="multipart/form-data" name="crop-imge" id="myform"
							 tal:attributes="action string:${context/absolute_url|nothing}/myvindula-user-crop">
							
							<input type="hidden" id="username" name="username" value="" 
								    tal:attributes="value member/getUserName|nothing">

							<div class="row">
								<div class="cell width-6 position-0">
									<div id="testWrap">
										<img alt="Recortar Imagem" id="usertImage"
									 		 tal:attributes="src string: ${context/portal_url|nothing}/user-image?id=${view/id_photo|nothing}&full=true"
									 	/>
									</div>
								</div>
								<div class="cell width-4 position-12">
									<h2>Preview</h2>
									<div style="width:100px;height: 100px;overflow: hidden;">
										<img alt="Recortar Imagem" id="preview"
								     		 tal:attributes="src string: ${context/portal_url|nothing}/user-image?id=${view/id_photo|nothing}&full=true"/>
									</div>
								
								</div>
							</div>							
							
							<input type="hidden" name="id" id="id" tal:attributes="value view/id_photo|nothing"/>
							<!-- Informação de crop da imagem-->
							<input type="hidden" name="cort-x" id="cort-x" />
							<input type="hidden" name="cort-y" id="cort-y" />
							<input type="hidden" name="cort-x2" id="cort-x2" />
							<input type="hidden" name="cort-y2" id="cort-y2" />
							
							<div id="buttom">
								<input type="hidden" name="form.crop:boolean" value="True" />
								<input type="submit" name="submit" value="Cortar" class="context bt_comments" />
							</div>
						</form>
					</fieldset>

				</div>
				<div id="crop-susseco" tal:condition="request/form.crop|nothing">
					<script type="text/javascript">
						$j = jQuery.noConflict();
						
						$j(document).ready(function(){
							$j('div.close', window.parent.document).trigger('click');
							window.parent.mostraFoto();
							
						});
						
						
					</script>	
				</div>
				<!--div id="crop-susseco" tal:condition="request/form.crop|nothing">
					<h2>Preview</h2>
					<div >
						<img alt="Preview" id="preview"
						     tal:attributes="src string: ${context/portal_url|nothing}/user-image?id=${view/id_photo|nothing}"/>
					</div>
					<div id="buttom">
						<a style="cursor:pointer" tal:attributes="href string: ${context/portal_url|nothing}/myvindula-user-crop">
							<input type="button" name="submit" value="Fechar" class="context bt_comments" />
						</a>
					
					</div>
																			
				</div-->
		</div>
	</body>
</html>